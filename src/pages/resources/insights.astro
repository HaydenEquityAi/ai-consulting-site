---
import Layout from "../../layouts/Layout.astro";
import InsightsHero from "../../components/resources/InsightsHero.astro";
import FeaturedArticle from "../../components/resources/FeaturedArticle.astro";
import ArticlesGrid from "../../components/resources/ArticlesGrid.astro";
import NewsletterSection from "../../components/resources/NewsletterSection.astro";

// Get all insight articles (if they exist)
let allArticles: any[] = [];
try {
  const articles = await import.meta.glob('../../content/insights/*.md', { 
    eager: true 
  });
  allArticles = Object.entries(articles).map(([path, module]: [string, any]) => {
    const filename = path.split('/').pop() || '';
    const slug = filename.replace('.md', '');
    return {
      data: module.frontmatter,
      slug: slug,
      url: `/resources/insights/${slug}`
    };
  });
} catch (e) {
  // If content directory doesn't exist yet, use sample data
  allArticles = [];
}

// Sort by date, newest first
const sortedArticles = allArticles.sort((a, b) => {
  const dateA = new Date(a.data?.date || a.date || '2000-01-01').getTime();
  const dateB = new Date(b.data?.date || b.date || '2000-01-01').getTime();
  return dateB - dateA;
});

// Featured is first, rest go in grid
const featured = sortedArticles[0];
const latestArticles = sortedArticles.slice(1, 13); // Show 12 articles after featured

// Sample data if no articles exist yet
const sampleFeatured = {
  data: {
    title: "The Architecture Question Your Business Needs to Ask",
    excerpt: "Why your current business systems are costing you more than they're helping—and what actually works.",
    author: "Hayden",
    date: "2025-01-15",
    category: "Systems Architecture",
    image: "/logos/Modern Architecture vs. Legacy Systems .png"
  },
  slug: "the-architecture-question"
};

const sampleArticles = [
  {
    data: {
      title: "The Complete Guide to Enterprise AI Integration: From Strategy to Operational Excellence",
      excerpt: "Why most AI initiatives fail—and how to actually get real value from AI in your organization.",
      author: "Hayden Ashley",
      date: "2025-01-07",
      image: "/logos/Enterprise AI Integration.png"
    },
    slug: "enterprise-ai-integration"
  },
  {
    data: {
      title: "Understanding System Architecture Patterns",
      excerpt: "Learn the fundamental patterns that make systems scalable, maintainable, and reliable.",
      author: "John Doe",
      date: "2023-12-15",
      image: "/images/insights/architecture-patterns.jpg"
    },
    slug: "system-architecture-patterns"
  },
  {
    data: {
      title: "Operations Excellence Through Automation",
      excerpt: "How to identify automation opportunities and implement them effectively.",
      author: "Alex Brown",
      date: "2023-12-10",
      image: "/images/insights/automation.jpg"
    },
    slug: "operations-automation"
  },
  {
    data: {
      title: "API Integration Best Practices",
      excerpt: "Essential strategies for connecting systems and ensuring reliable data flow.",
      author: "John Doe",
      date: "2023-12-05",
      image: "/images/insights/api-integration.jpg"
    },
    slug: "api-integration"
  },
  {
    data: {
      title: "Leadership in the Age of AI",
      excerpt: "How executives can navigate AI adoption and make strategic technology decisions.",
      author: "Sarah Miller",
      date: "2023-11-28",
      image: "/images/insights/leadership-ai.jpg"
    },
    slug: "leadership-ai"
  },
  {
    data: {
      title: "Data-Driven Decision Making",
      excerpt: "Building systems that turn data into actionable insights for business leaders.",
      author: "Alex Brown",
      date: "2023-11-20",
      image: "/images/insights/data-driven.jpg"
    },
    slug: "data-driven-decisions"
  }
];
---

<Layout title="Insights - Articles and Perspectives on Business Systems, AI, and Operations - intelio">
<main class="bg-white min-h-screen pt-20">
  <InsightsHero />
  
  {featured ? (
    <FeaturedArticle
      title={featured.data?.title || featured.title}
      excerpt={featured.data?.excerpt || featured.excerpt}
      author={featured.data?.author || featured.author}
      date={featured.data?.date || featured.date}
      category={featured.data?.category || featured.category}
      image={featured.data?.image || featured.image}
      slug={featured.slug ? `/resources/insights/${featured.slug}` : (featured.url || '#')}
    />
  ) : (
    <FeaturedArticle
      title={sampleFeatured.data.title}
      excerpt={sampleFeatured.data.excerpt}
      author={sampleFeatured.data.author}
      date={sampleFeatured.data.date}
      category={sampleFeatured.data.category}
      image={sampleFeatured.data.image}
      slug={`/resources/insights/${sampleFeatured.slug}`}
    />
  )}
  
  {latestArticles.length > 0 ? (
    <ArticlesGrid articles={latestArticles} />
  ) : (
    <ArticlesGrid articles={sampleArticles} />
  )}
  
  <NewsletterSection />
  
  <section class="text-center py-12 px-6">
    <a href="/resources" class="inline-flex items-center text-blue-600 font-semibold hover:text-blue-700 transition-colors">
      View all resources
      <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
      </svg>
    </a>
  </section>
</main>
</Layout>

<style>
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .featured-article > div {
      grid-template-columns: 1fr !important;
    }
    
    .articles-grid > div {
      grid-template-columns: 1fr !important;
    }
  }
</style>
